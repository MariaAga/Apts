# Apts
## <div dir="rtl">פרוייקט סיום תכנות מתקדם תשע"ח סמסטר ב</div>

<div dir="rtl"><ul>

עליכם לכתוב תכנית המנהלת מאגר של דירות למכירה.
עבור כל דירה תהיה רשומת אינפורמציה על פי הפירוט הבא:

1.	קוד דירה – מספר רץ שיינתן על ידי התכנית לדירות (יתחיל מ-1)
2.	כתובת הדירה - מחרוזת
3.	מחיר הדירה – מספר מסוג int
4.	מספר חדרים – מספר מסוג short int
5.	תאריך כניסה – יום, חודש ושנה (מספרים מסוג short int)

עבור כל דירה, בנוסף לנתוניה, יישמר גם  תאריך הכניסה למאגר. (לשם כך יהיה עליכם להשתמש בפונקציות כגון time, ctime ).

הדירות עצמן ישבו במאגרים בזיכרון, ובסיום התכנית יישמרו בקובץ בינארי.


מהלך התכנית:

על התכנית לקלוט מהמשתמש "פקודות" ולבצע אותן. הפקודה exit תסיים את התכנית.
ניתן להניח שהקלט מהמשתמש תקין.

הפקודות האפשריות הן:

•	get-an-apt –MaximumPrice 1500000

יודפסו למסך פרטי כל הדירות שמחירן עד 1500000 שקל
•	get-an-apt –MinimumNumRooms 3

יודפסו למסך פרטי כל הדירות בעלות 3 חדרים לפחות
•	get-an-apt –MaximumNumRooms 5

יודפסו למסך פרטי כל הדירות בעלות 5 חדרים לכל היותר

•	get-an-apt –Date 01052017

יודפסו למסך פרטי כל הדירות שמתפנות עד לתאריך 1 במאי 2017


ניתן לשלב מספר דרישות, למשל: 

•	get-an-apt    –MinimumNumRooms 3 –MaximumNumRooms 5 
–MaximumPrice 1750000

לכל אחת מהפקודות לעיל ניתן להוסיף את האופציה –s ולקבל את המידע ממוין מהמחיר הנמוך ביותר ועד למחיר הגבוה ביותר, או את האופציה –sr ולקבל את המידע ממוין מהמחיר הגבוה ביותר ועד לנמוך.

למשל,

•	get-an-apt –MaximumNumRooms 5 -sr

יודפסו למסך פרטי כל הדירות בעלות 5 חדרים לכל היותר ממוינות מהיקרה ביותר לזולה ביותר.



•	add-an-apt "Hasavyonim 23 Ramat Ono" 2000000 4 01 01 20

הוספת דירה למאגר ברחוב הסביונים 23 רמת אונו, שמחירה 2 מיליון ₪, מספר החדרים בה 4 ותאריך הכניסה הוא 1.1.20.
ההוספה תהיה למאגר בזיכרון בלבד, ואילו בתום ריצת התכנית כל נתוני הדירות שהתווספו בעקבות הפקודה add-an-apt יישמרו בקובץ.

•	buy-an-apt <number>

פקודה זו תסמל קניה של הדירה שהקוד שלה הוא  number וכמובן תגרום להוצאתה מהמאגר.

•	get-an-apt –Enter <x>

יודפסו הקודים של הדירות שנכנסו למאגר ב- <x> יממות האחרונות

•	delete-an-apt –Enter <x>

יוצאו מהמאגר הדירות שנכנסו אליו ב- <x> יממות האחרונות


גם את הפקודות עצמן עליכם לאחסן באחד משני מאגרים כפי שיתואר להלן:
      מאגר א':  תור שימומש על ידי מערך של 7 פוינטרים המכיל את 7 הפקודות 
                    האחרונות שנקלטו מן המשתמש.  יתכנו פוינטרים ריקים (שערכם NULL) כל 
                    עוד לא נקלטו 7 הפקודות הראשונות.
                    להלן הגדרת המערך:
#define N 7
char *short_term_history[N];



      מאגר ב':  רשימה מקושרת של הפקודות הוותיקות יותר. 

התוכנית מציגה בכל שלב prompt למשתמש וקולטת ממנו פקודה.  הפקודה יכולה להיות פקודה מסוג get-an-apt, מסוג add-an-apt, מסוג ,buy-an-apt מסוג delete-an-apt או בקשה לשחזור פקודת מן המאגר (אופציות השחזור מתוארות בהמשך). 
על התוכנית לבצע את הפקודה ולאחר מכן לאגור את הפקודה (הרגילה או המשוחזרת) במאגר א'.  אם מאגר א' מלא, יש להעביר את הפקודה הוותיקה ביותר ממאגר א' למאגר ב' ולעדכן את מאגר א' כך שיכיל את 7 הפקודות האחרונות (כולל הפקודה שהוכנסה אליו זה עתה).  

אופציות השחזור מן המאגר מפורטות להלן:
1.	הקשת !! תגרום להפעלת הפקודה האחרונה שהוכנסה למאגר א'.
2.	הקשת <num>! תגרום להפעלת פקודה בעלת המספר המצוין num. 
3.	הקשת short_history תגרום להדפסת 7 הפקודות העדכניות ביותר (מאגר א')
4.	הקשת history תגרום להדפסה של שני המאגרים.
באופציות 3 ו-4 ליד כל פקודה יודפס מספרה (מ-1 ואילך. הפקודה בעלת המספר המקסימלי היא הפקודה האחרונה שהוקשה).
5.	 הקשת !<num>^str1^str2 תגרום להפעלת הפקודה שמספרה num המכילה תת מחרוזת str1 ובה תוחלף אותה תת מחרוזת ל – str2.

לדוגמה, אם פקודה מס' 4 הייתה 


•	get-an-apt –MinimumNumRooms 3
אז הפקודה הבאה:
•	!4^3^2

תהיה למעשה הפקודה:
•	get-an-apt –MinimumNumRooms 2


הפקודות יישמרו בין ריצות של תכנית ולכן ניתן גם לשחזר פקודות שניתנו בריצה קודמת של התכנית. את הפקודות יש לשמור בקובץ טקסט מהאחרונה (חדשה ביותר) ועד לוותיקה ביותר.

שימו לב:  יש לטעון את הפקודות מקובץ הטקסט למאגרים בזכרון בתחילת כל תכנית. כמו כן, יש לטעון את הדירות מהקובץ הבינארי למאגר הדירות בתחילת כל תכנית.
התכנית תחפש אם קיימים הקבצים על פי  השם שבחרתם עבורם. (החל מהריצה השנייה הם כבר ימצאו).
בקובץ הפקודות יהיו הפקודות עצמן בלבד. בקובץ הדירות יהיו פרטי הדירות בלבד. אין להוסיף נתונים נוספים.


 
שמירת הדירות בקובץ בינארי:

קוד הדירה – יישמר כמספר בינארי מסוג short int
כתובת הדירה – יישמר אורך המחרוזת ב-short int ולאחר מכן המחרוזת (ללא '0\')
מחיר הדירה – יישמר כמספר בינארי מסוג int

יתר השדות מוגבלים בגודלם:

מספר חדרים – ידוע שיהיו לכל היותר 15 חדרים ולכן מספיקים 4 ביטים
תאריך כניסה לדירה – יום –     מספיקים 5 ביטים
		          חודש -  מספיקים 4 ביטים
		          שנה -    מספיקים 7 ביטים

למידע בדבר מספר החדרים ותאריך הכניסה מספיקים, אם כך, 20 ביטים כלומר 3 בתים.
נשתמש ב-3 בתים כאשר הביטים יאוחסנו בהם באופן הבא:

4 הביטים most significant יסמנו את מספר החדרים
5 הביטים שאחריהם יסמנו את יום הכניסה
4 הביטים שאחריהם יסמנו את חודש הכניסה
7 הביטים שאחריהם יסמנו את שנת הכניסה


לדוגמה, עבור דירה שמספר החדרים בה 4 ותאריך הכניסה הוא 28.4.16 נשמור את המידע אודות מספר החדרים ותאריך הכניסה בשלושה בתים כלהלן:
(הביטים החשובים משמאל)

01001110  00100001  00000000

ההדגשות נועדו להבהיר את הערכים והרווחים להמחשת הבתים השונים.

לאחר מכן נוסיף גם את תאריך הכניסה למאגר:
תאריך כניסה למאגר – יום –     מספיקים 5 ביטים
		          חודש -  מספיקים 4 ביטים
		          שנה -    מספיקים 7 ביטים


הערה: בסיום תאריך הכניסה לדירה ישנם 4 ביטים לא מנוצלים (4 אפסים). יש להשאיר אותם ולהתחיל את כתיבת תאריך הכניסה למאגר מbyte חדש.
</ul></div>
